
<!doctype html>
<html lang="en">
  <head>
    <title>
      FubuTransportation - Overview</title>
    
<meta charset="utf-8"/>
<meta name="description" content="FubuDocs"/>
<meta name="author" content="FubuDocs"/>




<link href="/_content/styles/sons-of-obsidian.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr-responsive.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.core.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.theme.css" rel="stylesheet" type="text/css" />

<link media="screen" type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Oswald:400,300">

    
  </head>
  <body data-spy="scroll" data-target=".bs-docs-sidebar" position="relative">
      
    <div class="container">
      
      

<div class="row">
  <div class="span6">
    <p class="logo">
      <a href="/topics" title="Fubu" class="root-link"><span>Fubu</span></a>
      <a href="/fubutransportation" title="Low friction Service Bus using the best of the Fubu world" class="project-logo"><span>FubuTransportation</span></a>
    </p>
  </div>
  <div class="span6">
    <div class="top-header text-right">
      <em>
        <em><a href="https://groups.google.com/forum/?fromgroups#!forum/fubumvc-devel">Join our vibrant mailing list</a></em>
      </em>
      <div class="social">
        <a href="http://github.com/DarthFubuMVC/FubuTransportation" class="ico-github"><img alt="Github" src="/_content/images/github-icon.png" /></a>
      </div>
    </div>
  </div>
</div>
      

      <div id="nav-follow" class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <ul class="nav"><li><a href="/fubutransportation" data-key="index">FubuTransportation &#187;</a></li><li><a href="/fubutransportation/sagas" data-key="index">Message Workflows (Sagas) &#187;</a></li><li class="active"><a href="/fubutransportation/sagas/overview" data-key="overview">Overview &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/fubutransportation/sagas" title="Message Workflows (Sagas)">Previous</a></li><li><a href="/fubutransportation/sagas/coffee-shop-sample" title="Coffee Shop Sample">Next</a></li></ul>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row">
        
        

        <div class="row">
          <div class="span3 sidebar" data-spy="affix" data-offset-top="150" data-offset-bottom="200">
            
            <h3 class="half-margin">Topics</h3>
            <ul id="page-toc" class="nav nav-tabs nav-stacked bs-docs-sidebar">
            </ul>
            <br/>
            <h3>
              FubuTransportation v0.5.0.0
            </h3>

            <br/>
            <h3 class="no-margin">Next</h3>
<p><a href="/fubutransportation/sagas/coffee-shop-sample" data-key="coffee-shop-sample">Coffee Shop Sample</a></p>
<h3 class="no-margin">Previous</h3>
<p><a href="/fubutransportation/sagas" data-key="index">Message Workflows (Sagas)</a></p>
          </div>
          <div class="span9">

              <h1 class="no-margin">Overview</h1>
              <hr class="header-line topic-line"></hr>

            <!--Title: Overview-->
<!--Url: overview-->
<p>Sagas in FubuTransportation are simply a workflow of correlated messages that share a common state.
Sagas are special handler classes that implement IStatefulSaga&lt;TState&gt;.
The TState is the class that represents the shared state for a running instance of a saga. In addition
messages are by default correlated by messages containing a property of type Guid named CorrelationId. This can
be overridden by implementing your own ISagaRepository for the state type needing alternative behavior.</p>

<p>How do you start a workflow? In FubuTransportation starting a saga happens when your handler
instanciates and sets the State property while receiving a message. In some alternative frameworks this is done by declaring another interfaces 
like Initiates&lt;TMessage&gt;. However we felt it more important for testability that a saga contains all of its state. By default after a saga
has been started a SagaBehavior will load the state from the ISagaRepository for you. So from within your handlers if the State
is already populated the saga has already been started previously by another message.</p>

<p>Completing a saga occurs when the handler class returns true from the method IsCompleted(). When a saga is completed
the SagaBehavior will automatically remove the state from the saga repository.</p>

<p>One thing to consider when dealing with distributed and concurrent systems is multiple
messages may come in for a given saga instance at the same time. The way FubuTransportation deals
with this is by leveraging optimistic concurrency within the saga persistence layer. It is expected
that the persistence layer will indicate or throw when trying to update a state that has already
been modified since retrieving. This will get covered in more detail in the section on Saga Storage.</p>

<p>Here is an example of a very simple saga.</p>

<pre data-linenums="7" class="prettyprint lang-cs">
    public class SimpleSagaHandler : IStatefulSaga&lt;SimpleSagaState&gt;
    {
        public SimpleSagaState State { get; set; }

        public bool IsCompleted()
        {
            return State.Switch == SwitchState.Exit;
        }

        public void Handle(StartCommand command)
        {
            State = new SimpleSagaState {Switch = SwitchState.Active};
        }

        public void Handle(PauseCommand command)
        {
            State.Switch = SwitchState.Paused;
        }

        public void Handle(ResumeCommand command)
        {
            if (State.Switch == SwitchState.Paused)
            {
                State.Switch = SwitchState.Paused;
            }
        }

        public void Handle(EndCommand command)
        {
            State.Switch = SwitchState.Inactive;
        }

        public void Handle(ExitCommand command)
        {
            if (State.Switch == SwitchState.Inactive)
            {
                State.Switch = SwitchState.Exit;
            }
        }
    }

    public class SimpleSagaState
    {
        public SimpleSagaState()
        {
            Switch = SwitchState.Inactive;
        }

        public Guid Id { get; set; }
        public SwitchState Switch { get; set; }
    }

    public enum SwitchState
    {
        Inactive,
        Active,
        Paused,
        Exit
    }

    public class StartCommand
    {
        public Guid CorrelationId { get; set; }
    }

    public class PauseCommand
    {
        public Guid CorrelationId { get; set; }
    }

    public class ResumeCommand
    {
        public Guid CorrelationId { get; set; }
    }

    public class EndCommand
    {
        public Guid CorrelationId { get; set; }
    }

    public class ExitCommand
    {
        public Guid CorrelationId { get; set; }
    }
</pre>







          </div>
        </div>
      </div>
    </div>

    <br></br>
    <hr></hr>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <ul class="nav"><li><a href="/fubutransportation" data-key="index">FubuTransportation &#187;</a></li><li><a href="/fubutransportation/sagas" data-key="index">Message Workflows (Sagas) &#187;</a></li><li class="active"><a href="/fubutransportation/sagas/overview" data-key="overview">Overview &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/fubutransportation/sagas" title="Message Workflows (Sagas)">Previous</a></li><li><a href="/fubutransportation/sagas/coffee-shop-sample" title="Coffee Shop Sample">Next</a></li></ul>
        </div>
      </div>
    </div>
    
    
    

<script type="text/javascript" src="/_content/scripts/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="/_content/scripts/prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/bootstrap-prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs.js"></script>
<script type="text/javascript" src="/_content/scripts/jquery.nestable.js"></script>
<script type="text/javascript" src="/_content/scripts/toastr.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap.min.js"></script>
<script type="text/javascript" src="/_content/scripts/diagnostics/bootstrap-scrollspy.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs-tools.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap-affix.js"></script>
<script type="text/javascript" src="/_content/scripts/topics.js"></script>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
      Powered by <a href="http://github.com/DarthFubuMVC/FubuDocs">FubuDocs</a>.
    </p>
  </div>
</footer>
  </body>
</html>