
<!doctype html>
<html lang="en">
  <head>
    <title>
      FubuTransportation - Saga Storage</title>
    
<meta charset="utf-8"/>
<meta name="description" content="FubuDocs"/>
<meta name="author" content="FubuDocs"/>




<link href="/_content/styles/sons-of-obsidian.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr-responsive.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.core.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.theme.css" rel="stylesheet" type="text/css" />

<link media="screen" type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Oswald:400,300">

    
  </head>
  <body data-spy="scroll" data-target=".bs-docs-sidebar" position="relative">
      
    <div class="container">
      
      

<div class="row">
  <div class="span6">
    <p class="logo">
      <a href="/topics" title="Fubu" class="root-link"><span>Fubu</span></a>
      <a href="/fubutransportation" title="Low friction Service Bus using the best of the Fubu world" class="project-logo"><span>FubuTransportation</span></a>
    </p>
  </div>
  <div class="span6">
    <div class="top-header text-right">
      <em>
        <em><a href="https://groups.google.com/forum/?fromgroups#!forum/fubumvc-devel">Join our vibrant mailing list</a></em>
      </em>
      <div class="social">
        <a href="http://github.com/DarthFubuMVC/FubuTransportation" class="ico-github"><img alt="Github" src="/_content/images/github-icon.png" /></a>
      </div>
    </div>
  </div>
</div>
      

      <div id="nav-follow" class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <ul class="nav"><li><a href="/fubutransportation" data-key="index">FubuTransportation &#187;</a></li><li><a href="/fubutransportation/sagas" data-key="index">Message Workflows (Sagas) &#187;</a></li><li class="active"><a href="/fubutransportation/sagas/saga-storage" data-key="saga-storage">Saga Storage &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/fubutransportation/sagas/coffee-shop-sample" title="Coffee Shop Sample">Previous</a></li><li><a href="/fubutransportation/polling-jobs" title="Polling Jobs">Next</a></li></ul>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row">
        
        

        <div class="row">
          <div class="span3 sidebar" data-spy="affix" data-offset-top="150" data-offset-bottom="200">
            
            <h3 class="half-margin">Topics</h3>
            <ul id="page-toc" class="nav nav-tabs nav-stacked bs-docs-sidebar">
            </ul>
            <br/>
            <h3>
              FubuTransportation v0.6.0.0
            </h3>

            <br/>
            <h3 class="no-margin">Next</h3>
<p><a href="/fubutransportation/polling-jobs" data-key="polling_jobs">Polling Jobs</a></p>
<h3 class="no-margin">Previous</h3>
<p><a href="/fubutransportation/sagas/coffee-shop-sample" data-key="coffee-shop-sample">Coffee Shop Sample</a></p>
          </div>
          <div class="span9">

              <h1 class="no-margin">Saga Storage</h1>
              <hr class="header-line topic-line"></hr>

            <!--Title: Saga Storage-->
<!--Url: saga-storage-->
<p>Saga state is by default stored and retrieved by the message CorrelationId:Guid.
The state is expected to have a property named Id of type Guid. If this is the case,
your saga storage and retrieval will happen automatically from the SagaBehavior. If you need
to customize the lookup you can do so following the sample below as a guideline.</p>

<pre data-linenums="11" class="prettyprint lang-cs">
    public class SagaRepositorySampleTransportRegistry : FubuTransportRegistry
    {
        public SagaRepositorySampleTransportRegistry()
        {
            //if overriding the repository of a specific chain
            Local.Policy&lt;AlternativeRepositoryPolicy&gt;();

            //or if globally overriding all saga persistence
            SagaStorage&lt;AlternativeSagaStorage&gt;();
        }
    }

    public class AlternativeSagaStorage : ISagaStorage
    {
        public ObjectDef RepositoryFor(SagaTypes sagaTypes)
        {
            //A good place if needing something like RavenDbSagaRepository
            //The ObjectDef returned here will be a class that implements ISagaRepository
            //InMemorySagaRepository is a good example of one to look at
            return new ObjectDef(typeof(SagaRepositorySample));
        }
    }

    public class AlternativeRepositoryPolicy : HandlerChainPolicy
    {
        public override void Configure(HandlerChain handlerChain)
        {
            handlerChain.OfType&lt;StatefulSagaNode&gt;().Each(x =&gt;
            {
                x.Repository = new ObjectDef(typeof(SagaRepositorySample));
            });
        }

        public override bool Matches(HandlerChain chain)
        {
            //You should apply condition to filter &#39;custom&#39; repository to only the chain the needs it
            return true;
        }
    }

    public class SagaRepositorySample : ISagaRepository&lt;DummyState, StartMessage&gt;
    {
        public void Save(DummyState state, StartMessage message)
        {
            //Save changes to storage
        }

        public DummyState Find(StartMessage message)
        {
            //Passes the message for alternative lookup or key strategies.
            //If the message has CorrelationId:Guid a custom saga repository is not necessary
            //If state is found, the saga has already been started
            return null;
        }

        public void Delete(DummyState state, StartMessage message)
        {
            //The saga was completed, now delete or expire the saga instance
        }
    }

    public class StartMessage
    {
        public Guid CorrelationId { get; set; }
    }

    public class DummyState
    {
        public bool IsImportant { get; set; }
    }
</pre>







          </div>
        </div>
      </div>
    </div>

    <br></br>
    <hr></hr>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <ul class="nav"><li><a href="/fubutransportation" data-key="index">FubuTransportation &#187;</a></li><li><a href="/fubutransportation/sagas" data-key="index">Message Workflows (Sagas) &#187;</a></li><li class="active"><a href="/fubutransportation/sagas/saga-storage" data-key="saga-storage">Saga Storage &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/fubutransportation/sagas/coffee-shop-sample" title="Coffee Shop Sample">Previous</a></li><li><a href="/fubutransportation/polling-jobs" title="Polling Jobs">Next</a></li></ul>
        </div>
      </div>
    </div>
    
    
    

<script type="text/javascript" src="/_content/scripts/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="/_content/scripts/prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/bootstrap-prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs.js"></script>
<script type="text/javascript" src="/_content/scripts/jquery.nestable.js"></script>
<script type="text/javascript" src="/_content/scripts/toastr.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap.min.js"></script>
<script type="text/javascript" src="/_content/scripts/diagnostics/bootstrap-scrollspy.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs-tools.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap-affix.js"></script>
<script type="text/javascript" src="/_content/scripts/topics.js"></script>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
      Powered by <a href="http://github.com/DarthFubuMVC/FubuDocs">FubuDocs</a>.
    </p>
  </div>
</footer>
  </body>
</html>